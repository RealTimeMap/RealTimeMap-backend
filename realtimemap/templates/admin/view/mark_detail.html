{% extends "detail.html" %}
{% from "components/common/map.html" import map_component %}
{% from "components/common/card.html" import card %}

{% block content %}
    <link rel="stylesheet" href="{{ url_for('static', path='admin/css/mark-detail.css') }}">
    <style>
        .status-badge--category {
            background-color: {{ raw_obj.category.color }};
        }
    </style>

    <div class="detail-page">
        <header class="detail-page__header">
            <h1 class="detail-page__title">
                Mark: <span class="highlight">{{ obj.mark_name | safe }}</span>
            </h1>
            <div class="detail-page__actions">
                {% include "components/common/edit_btn.html" %}
                {% include "components/common/delete_btn.html" %}
            </div>
        </header>

        <main class="detail-page__content">
            <!-- LEFT COLUMN -->
            <section class="detail-page__main-column">
                {% call card(title="Location") %}
                    <div class="content-card__body" style="padding: 0;">
                        {{ map_component(geom=obj.geom, obj_id=obj.id, marker_text=obj.mark_name) }}
                    </div>
                {% endcall %}
                {% call card(title="Photos") %}
                    {% if obj.photo %}
                        <div class="photo-grid">
                            {% for photo in obj.photo %}
                                <img src="{{ photo.url }}" alt="Mark photo" class="photo-grid__image">
                            {% endfor %}
                        </div>
                    {% else %}
                        <p class="empty-state">No photos uploaded.</p>
                    {% endif %}
                {% endcall %}
            </section>

            <!-- RIGHT COLUMN -->
            <aside class="detail-page__sidebar-column">
                {% call card(icon="bi-info-circle-fill", title="Main Information", extra_classes="content-card--compact") %}
                    <div class="info-row">
                        <strong>Title</strong>
                        <span>{{ obj.mark_name | safe }}</span>
                    </div>
                    <div class="info-row">
                        <strong>Category</strong>
                        <span class="status-badge status-badge--category">
                            <a href="{{ url_for(__name__ ~ ':detail', identity='category', pk=raw_obj.category.id) }}">
                                {{ raw_obj.category.category_name }}
                            </a>
                        </span>
                    </div>
                    <div class="info-row">
                        <strong>Status</strong>
                        {% if obj.is_ended %}
                            <span class="status-badge status-badge--ended">Ended</span>
                        {% else %}
                            <span class="status-badge status-badge--active">Active</span>
                        {% endif %}
                    </div>
                    <div class="additional-info">
                        <strong class="additional-info__title">Additional Information:</strong>
                        <p class="additional-info__text">{{ obj.additional_info | safe }}</p>
                    </div>
                {% endcall %}
                {% call card(icon="bi-info-circle-fill", title="Time Data", extra_classes="content-card--compact") %}
                    <div class="info-row">
                        <strong>Start</strong>
                        <span>{{ obj.start_at }}</span>
                    </div>
                    <div class="info-row">
                        <strong>Duration</strong>
                        <span>{{ obj.duration }} hours</span>
                    </div>
                    <div class="info-row">
                        <strong>Completion (estimated)</strong>
                        <span>{{ obj.end_at }}</span>
                    </div>
                {% endcall %}
                {% call card(icon="bi-info-circle-fill", title="Technical Information", extra_classes="content-card--compact") %}
                    <div class="info-row">
                        <strong>Mark ID</strong>
                        <span>{{ obj.id }}</span>
                    </div>
                    <div class="info-row">
                        <strong>Owner</strong>
                        <a href="{{ url_for(__name__ ~ ':detail', identity='user', pk=raw_obj.owner.id) }}">
                            {{ raw_obj.owner.username }}
                        </a>
                    </div>
                    <div class="info-row">
                        <strong>Coordinates</strong>
                        <span>{{ obj.geom }}</span>
                    </div>
                    <div class="info-row">
                        <strong>Geohash</strong>
                        <span class="monospace">{{ obj.geohash }}</span>
                    </div>
                    <div class="info-row">
                        <strong>Created at</strong>
                        <span>{{ obj.created_at }}</span>
                    </div>
                    <div class="info-row">
                        <strong>Updated at</strong>
                        <span>{{ obj.updated_at }}</span>
                    </div>
                {% endcall %}
            </aside>
        </main>
    </div>

{% endblock %}